function getRandomArbitrary(e,t){return Math.random()*(t-e)+e}function getRandom(e,t){return Math.floor(Math.random()*(t-e+1))+e}function componentToHex(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function rgbToHex(e,t,o){return"#"+componentToHex(e)+componentToHex(t)+componentToHex(o)}function hexToRgb(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function map(e,t,o,a,n){return(e-t)*(n-a)/(o-t)+a}function generate(){triangleAmount=getRandom(10,70);var e=getRandom(0,triangleAmount),t;t=getRandom(0,6)?"rgba(0,0,0)":"rgba(255,255,255)",paper=new Raphael(0,0,width,height),paper.rect(0,0,width,height).attr({fill:t,stroke:"none"});for(var o=0;triangleAmount>=o;o++){var a,n,r,i,g,d,c;o%4===0?(n=getRandom(0,width/2),r=0,i=getRandom(0,width),g=height,d=getRandom(width/2,width),c=0):o%3===0?(n=width,r=getRandom(0,height/2),i=0,g=getRandom(0,height),d=width,c=getRandom(height/2,height)):o%2===0?(n=getRandom(0,width/2),r=height,i=getRandom(0,width),g=0,d=getRandom(width/2,width),c=height):o%1===0&&(n=0,r=getRandom(0,height/2),i=width,g=getRandom(0,height),d=0,c=getRandom(height/2,height));var l="0,0,0",h=getRandomArbitrary(.01,.1);o===e&&(l="232,87,46",h=getRandom(.6,.9)),a=paper.path("M"+n+","+r+"L"+i+","+g+"L"+d+","+c).attr({fill:"rgba("+l+","+h+")",stroke:"none"})}}function toggle(e){switch(e){case"color":colorToggle=colorToggle?!1:!0,$("li#color").toggleClass("selected");break;case"opacity":opacityToggle=opacityToggle?!1:!0,$("li#opacity").toggleClass("selected");break;case"background":backgroundToggle=backgroundToggle?!1:!0,$("li#background").toggleClass("selected")}}function change(e){if(changeCheck===!0){"undefined"==typeof e&&(e=1);for(var t=0;e>t;t++){var o=$("path[fill="+prevColor+"]").next("path");if(0===o.length&&(o=$("path").first()),colorToggle===!1){var a=getRandom(0,255);color=rgbToHex(a,a,a)}else color=rgbToHex(getRandom(0,255),getRandom(0,255),getRandom(0,255));opacityToggle&&o.attr("fill-opacity",getRandomArbitrary(.005,.2)),backgroundToggle&&$("rect").attr("fill",color),o.attr("fill",color),prevColor=color}}}function generateLink(e,t){$("div#saved").remove(),paper.setViewBox(0,0,width,height),paper.canvas.setAttribute("preserveAspectRatio","none"),$("svg").attr("width",1440).attr("height",900),$("body").append('<canvas id="placeholder"></canvas>');var o=$("canvas#placeholder");canvg("placeholder",$("<svg />").append($("svg").clone()).html());var a=o[0].toDataURL();$("body").append('<div id="saved"><a href="'+a+'" download="treep.png">&#8677;</a></div>'),$("div#saved").css({left:e-$("div#saved").width()/2,top:t-$("div#saved").height()/2}).hide().fadeIn(100),o.remove(),$("svg").attr("width",width).attr("height",height)}var paper,triangleAmount,width=$(window).width(),height=$(window).height(),colorToggle=!1,opacityToggle=!1,backgroundToggle=!1,color,prevColor=rgbToHex(232,87,46),changeCheck=!0;$(document).ready(function(){var e=0,t=0,o=0,a=0,n,r,i,g,d;generate(),$(document).mousemove(function(n){e=n.pageX,t=n.pageY,o!==n.pageX&&a!==n.pageY&&($("body").css("cursor","none"),$("div#saved").remove(),change(),o=n.pageX,a=n.pageY)}),document.ontouchmove=function(e){e.preventDefault(),change()},$(document).on("mousestop",function(){generateLink(e,t)}),$(document).keypress(function(o){o.preventDefault(),n||(97===o.which||65===o.which?toggle("color"):115===o.which||83===o.which?toggle("opacity"):100===o.which||68===o.which?toggle("background"):32===o.which&&(paper.remove(),generate(),change(triangleAmount),$("li#randomise").addClass("selected"),n||generateLink(e,t)))}),$(document).keydown(function(e){}),$(document).keyup(function(e){32===e.which&&$("li#randomise").removeClass("selected")}),$("ul li").click(function(){"color"===$(this).attr("id")?toggle("color"):"opacity"===$(this).attr("id")?toggle("opacity"):"background"===$(this).attr("id")?toggle("background"):"randomise"===$(this).attr("id")&&(paper.remove(),generate(),change(triangleAmount),$("li#randomise").addClass("selected"),$("li#randomise").removeClass("selected"))}),$("svg").children().hover(function(){n&&(r=$(this),i=r.attr("fill"),g=r.attr("fill-opacity"),r.attr("fill","#E8572E"),r.attr("fill-opacity","0.75"))},function(){n&&(r.attr("fill",i),r.attr("fill-opacity",g))}),$("body").delegate("div#saved a","click",function(){var e=$("div#saved a").attr("href");$.post("save.php",{imgData:e})})});