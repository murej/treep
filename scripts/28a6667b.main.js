function b64toBlob(a,b,c){b=b||"",c=c||512;for(var d=atob(a),e=[],f=0;f<d.length;f+=c){for(var g=d.slice(f,f+c),h=new Array(g.length),i=0;i<g.length;i++)h[i]=g.charCodeAt(i);var j=new Uint8Array(h);e.push(j)}var k=new Blob(e,{type:b});return k}function uploadMedia(a,b){$.ajax({type:"POST",url:"https://api-content.dropbox.com/1/files_put/auto/"+a,headers:{Authorization:"Bearer XVeOb0MKbDwAAAAAAAAKNlnrMfkSqFFq_bK8hOfOQOI8aM58i0HI4QfcjRwK8crJ","Content-Type":"image/png"},dataType:"html",processData:!1,data:b,error:function(a,b,c){console.log("Error when uploading file: "+b+" because:"+c)}})}function getRandomArbitrary(a,b){return Math.random()*(b-a)+a}function getRandom(a,b){return Math.floor(Math.random()*(b-a+1))+a}function componentToHex(a){var b=a.toString(16);return 1===b.length?"0"+b:b}function rgbToHex(a,b,c){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(c)}function hexToRgb(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null}function map(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d}function generate(){triangleAmount=getRandom(10,70);var a,b=getRandom(0,triangleAmount);a=getRandom(0,6)?"rgba(0,0,0)":"rgba(255,255,255)",paper=new Raphael(0,0,width,height),paper.rect(0,0,width,height).attr({fill:a,stroke:"none"});for(var c=0;triangleAmount>=c;c++){var d,e,f,g,h,i,j;c%4===0?(e=getRandom(0,width/2),f=0,g=getRandom(0,width),h=height,i=getRandom(width/2,width),j=0):c%3===0?(e=width,f=getRandom(0,height/2),g=0,h=getRandom(0,height),i=width,j=getRandom(height/2,height)):c%2===0?(e=getRandom(0,width/2),f=height,g=getRandom(0,width),h=0,i=getRandom(width/2,width),j=height):c%1===0&&(e=0,f=getRandom(0,height/2),g=width,h=getRandom(0,height),i=0,j=getRandom(height/2,height));var k="0,0,0",l=getRandomArbitrary(.01,.1);c===b&&(k="232,87,46",l=getRandom(.6,.9)),d=paper.path("M"+e+","+f+"L"+g+","+h+"L"+i+","+j).attr({fill:"rgba("+k+","+l+")",stroke:"none"})}}function toggle(a){switch(a){case"color":colorToggle=colorToggle?!1:!0,$("li#color").toggleClass("selected");break;case"opacity":opacityToggle=opacityToggle?!1:!0,$("li#opacity").toggleClass("selected");break;case"background":backgroundToggle=backgroundToggle?!1:!0,$("li#background").toggleClass("selected")}}function change(a){if(changeCheck===!0){"undefined"==typeof a&&(a=1);for(var b=0;a>b;b++){var c=$("path[fill="+prevColor+"]").next("path");if(0===c.length&&(c=$("path").first()),colorToggle===!1){var d=getRandom(0,255);color=rgbToHex(d,d,d)}else color=rgbToHex(getRandom(0,255),getRandom(0,255),getRandom(0,255));opacityToggle&&c.attr("fill-opacity",getRandomArbitrary(.005,.2)),backgroundToggle&&$("rect").attr("fill",color),c.attr("fill",color),prevColor=color}}}function generateLink(a,b){$("div#saved").remove(),paper.setViewBox(0,0,width,height),paper.canvas.setAttribute("preserveAspectRatio","none"),$("svg").attr("width",1440).attr("height",900),$("body").append('<canvas id="placeholder"></canvas>');var c=$("canvas#placeholder");canvg("placeholder",$("<svg />").append($("svg").clone()).html());var d=c[0].toDataURL();$("body").append('<div id="saved"><a href="'+d+'" download="treep.png">&#8677;</a></div>'),$("div#saved").css({left:a-$("div#saved").width()/2,top:b-$("div#saved").height()/2}).hide().fadeIn(100),c.remove(),$("svg").attr("width",width).attr("height",height)}!function(a){function b(){var b=this,c=a(this).data("mousestop");this.movement=!0,c.timeToStop&&(this.timeToStopTimer=window.setTimeout(function(){b.movement=!1,window.clearTimeout(b.timer)},c.timeToStop))}function c(){window.clearTimeout(this.timer),window.clearTimeout(this.timeToStopTimer)}function d(){var b=a(this),c=b.data("mousestop");this.movement&&(window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){b.trigger("mousestop")},c.delay))}function e(b){return a.isNumeric(b)?b={delay:b}:"object"!=typeof b&&(b={}),a.extend({},a.fn.mousestop.defaults,b)}a.event.special.mousestop={setup:function(f){a(this).data("mousestop",e(f)).bind("mouseenter.mousestop",b).bind("mouseleave.mousestop",c).bind("mousemove.mousestop",d)},teardown:function(){a(this).removeData("mousestop").unbind(".mousestop")}},a.fn.mousestop=function(a,b){return"function"==typeof a&&(b=a),arguments.length>0?this.bind("mousestop",a,b):this.trigger("mousestop")},a.fn.mousestop.defaults={delay:300,timeToStop:null}}(jQuery);var paper,triangleAmount,width=$(window).width(),height=$(window).height(),colorToggle=!1,opacityToggle=!1,backgroundToggle=!1,color,prevColor=rgbToHex(232,87,46),changeCheck=!0;$(document).ready(function(){var a,b,c,d,e=0,f=0,g=0,h=0;generate(),$(document).mousemove(function(a){e=a.pageX,f=a.pageY,g!==a.pageX&&h!==a.pageY&&($("body").css("cursor","none"),$("div#saved").remove(),change(),g=a.pageX,h=a.pageY)}),document.ontouchmove=function(a){a.preventDefault(),change()},$(document).on("mousestop",function(){generateLink(e,f)}),$(document).keypress(function(b){b.preventDefault(),a||(97===b.which||65===b.which?toggle("color"):115===b.which||83===b.which?toggle("opacity"):100===b.which||68===b.which?toggle("background"):32===b.which&&(paper.remove(),generate(),change(triangleAmount),$("li#randomise").addClass("selected"),a||generateLink(e,f)))}),$(document).keydown(function(a){}),$(document).keyup(function(a){32===a.which&&$("li#randomise").removeClass("selected")}),$("ul li").click(function(){"color"===$(this).attr("id")?toggle("color"):"opacity"===$(this).attr("id")?toggle("opacity"):"background"===$(this).attr("id")?toggle("background"):"randomise"===$(this).attr("id")&&(paper.remove(),generate(),change(triangleAmount),$("li#randomise").addClass("selected"),$("li#randomise").removeClass("selected"))}),$("svg").children().hover(function(){a&&(b=$(this),c=b.attr("fill"),d=b.attr("fill-opacity"),b.attr("fill","#E8572E"),b.attr("fill-opacity","0.75"))},function(){a&&(b.attr("fill",c),b.attr("fill-opacity",d))}),$("body").delegate("div#saved a","click",function(){var a=Date.now()+".png",b=$("div#saved a").attr("href").split(/,(.+)?/)[1],c=b64toBlob(b,"image/png");uploadMedia(a,c)})});